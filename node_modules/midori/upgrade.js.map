{"version":3,"sources":["../src/upgrade.js"],"names":["upgrade","handler","app","req","socket","head","nextApp","err","upgradeError","request","res","error","Error","requestError","_selector"],"mappings":";;;;;;;AACA;;;;;;AAUA;;;;;AAKA,MAAMA,OAAO,GAAIC,OAAD,IAAmCC,GAAD,IAAS;AACzD,2BACKA,GADL;AAEEF,IAAAA,OAAO,EAAE,OAAOG,GAAP,EAAYC,MAAZ,EAAoBC,IAApB,KAA6B;AACpC,UAAI;AACF,8CAAuBF,GAAvB,EAA4BC,MAA5B;AACA,cAAME,OAAO,GAAG,MAAML,OAAO,CAAC;AAACE,UAAAA,GAAD;AAAMC,UAAAA,MAAN;AAAcC,UAAAA;AAAd,SAAD,CAA7B;AACA,eAAOC,OAAO,CAACJ,GAAD,CAAP,CAAaF,OAAb,CAAqBG,GAArB,EAA0BC,MAA1B,EAAkCC,IAAlC,CAAP;AACD,OAJD,CAIE,OAAOE,GAAP,EAAY;AACZ,eAAOL,GAAG,CAACM,YAAJ,CAAiBD,GAAjB,EAAsBJ,GAAtB,EAA2BC,MAA3B,EAAmCC,IAAnC,CAAP;AACD;AACF,KAVH;AAWEI,IAAAA,OAAO,EAAE,CAACN,GAAD,EAAMO,GAAN,KAAc;AACrB,YAAMC,KAAK,GAAG,IAAIC,KAAJ,CAAU,6CAAV,CAAd;AACA,aAAOV,GAAG,CAACW,YAAJ,CAAiBF,KAAjB,EAAwBR,GAAxB,EAA6BO,GAA7B,CAAP;AACD;AAdH;AAgBD,CAjBD;;AAmBAV,OAAO,CAACc,SAAR,GAAoB,MAAM,IAA1B;;eAEed,O","sourcesContent":["// @flow\nimport {installUpgradeResponse} from './response';\nimport type {App} from './types';\nimport type {IncomingMessage} from 'http';\nimport type {Socket} from 'net';\ntype UpgradeHandler = ({\n  req: IncomingMessage,\n  socket: Socket,\n  head: Buffer,\n}) => App | Promise<App>;\n\n/**\n * Main thing.\n * @param {Function} handler Request handler. Must return another app creator.\n * @returns {App} App instance.\n */\nconst upgrade = (handler: UpgradeHandler): App => (app) => {\n  return {\n    ...app,\n    upgrade: async (req, socket, head) => {\n      try {\n        installUpgradeResponse(req, socket);\n        const nextApp = await handler({req, socket, head});\n        return nextApp(app).upgrade(req, socket, head);\n      } catch (err) {\n        return app.upgradeError(err, req, socket, head);\n      }\n    },\n    request: (req, res) => {\n      const error = new Error('Must only pass upgrade events to `upgrade`.');\n      return app.requestError(error, req, res);\n    },\n  };\n};\n\nupgrade._selector = () => null;\n\nexport default upgrade;\n"],"file":"upgrade.js"}