{"version":3,"sources":["../src/request.js"],"names":["request","handler","app","req","res","nextApp","result","err","requestError","upgrade","socket","head","upgradeError","_selector"],"mappings":";;;;;;;;;;;AAKA;;;;;AAKA,MAAMA,OAAO,GAAIC,OAAD,IAAmCC,GAAD,IAAS;AACzD,2BACKA,GADL;AAEEF,IAAAA,OAAO,EAAE,OAAOG,GAAP,EAAYC,GAAZ,KAAoB;AAC3B,UAAI;AACF,cAAMC,OAAO,GAAG,MAAMJ,OAAO,CAACE,GAAD,CAA7B;AACA,cAAMG,MAAM,GAAG,MAAMD,OAAO,CAACH,GAAD,CAAP,CAAaF,OAAb,CAAqBG,GAArB,EAA0BC,GAA1B,CAArB;AACA,eAAO,MAAME,MAAb;AACD,OAJD,CAIE,OAAOC,GAAP,EAAY;AACZ,eAAO,MAAML,GAAG,CAACM,YAAJ,CAAiBD,GAAjB,EAAsBJ,GAAtB,EAA2BC,GAA3B,CAAb;AACD;AACF,KAVH;AAWEK,IAAAA,OAAO,EAAE,OAAON,GAAP,EAAYO,MAAZ,EAAoBC,IAApB,KAA6B;AACpC,UAAI;AACF,cAAMN,OAAO,GAAG,MAAMJ,OAAO,CAACE,GAAD,CAA7B;AACA,eAAO,MAAME,OAAO,CAACH,GAAD,CAAP,CAAaO,OAAb,CAAqBN,GAArB,EAA0BO,MAA1B,EAAkCC,IAAlC,CAAb;AACD,OAHD,CAGE,OAAOJ,GAAP,EAAY;AACZ,eAAO,MAAML,GAAG,CAACU,YAAJ,CAAiBL,GAAjB,EAAsBJ,GAAtB,EAA2BO,MAA3B,EAAmCC,IAAnC,CAAb;AACD;AACF;AAlBH;AAoBD,CArBD;;AAuBAX,OAAO,CAACa,SAAR,GAAoB,MAAM,IAA1B;;eAEeb,O","sourcesContent":["// @flow\nimport type {App} from './types';\nimport type {IncomingMessage} from 'http';\ntype RequestHandler = (req: IncomingMessage) => App | Promise<App>;\n\n/**\n * Main thing.\n * @param {Function} handler Request handler. Must return another app.\n * @returns {App} App instance.\n */\nconst request = (handler: RequestHandler): App => (app) => {\n  return {\n    ...app,\n    request: async (req, res) => {\n      try {\n        const nextApp = await handler(req);\n        const result = await nextApp(app).request(req, res);\n        return await result;\n      } catch (err) {\n        return await app.requestError(err, req, res);\n      }\n    },\n    upgrade: async (req, socket, head) => {\n      try {\n        const nextApp = await handler(req);\n        return await nextApp(app).upgrade(req, socket, head);\n      } catch (err) {\n        return await app.upgradeError(err, req, socket, head);\n      }\n    },\n  };\n};\n\nrequest._selector = () => null;\n\nexport default request;\n"],"file":"request.js"}