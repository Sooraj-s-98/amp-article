"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.end = exports.headers = exports.setMark = void 0;

var _onHeaders = _interopRequireDefault(require("on-headers"));

var _onFinished = _interopRequireDefault(require("on-finished"));

var _response = _interopRequireDefault(require("./response"));

var _createSelector = _interopRequireDefault(require("./createSelector"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

let mark = process.hrtime;

const setMark = m => mark = m;

exports.setMark = setMark;

const finish = (then, callback) => {
  const end = mark(then);
  callback(end[0] / 1000 + end[1] / 1000000);
};

const headers = (0, _createSelector.default)(_response.default, res => {
  const then = mark();
  return new Promise(resolve => {
    (0, _onFinished.default)(res, () => finish(then, resolve));
    (0, _onHeaders.default)(res, () => finish(then, resolve));
  });
});
exports.headers = headers;
const end = (0, _createSelector.default)(_response.default, res => {
  const then = mark();
  return new Promise(resolve => {
    (0, _onFinished.default)(res, () => finish(then, resolve));
  });
});
exports.end = end;
const timing = {
  headers,
  end
};
var _default = timing;
exports.default = _default;
//# sourceMappingURL=timing.js.map